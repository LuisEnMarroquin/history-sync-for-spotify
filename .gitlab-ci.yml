image: tmaier/docker-compose:latest

stages:
  - deploy

variables:
  URL_NAME: spotify
  BASE_URL: marroquin.dev
  PROJECT_NAME: spotify_app
  USER_EMAIL: luis@marroquin.dev

deploy:
  stage: deployment
  script:
    - echo 'Deploying Production'
    - docker-compose --project-name ${PROJECT_NAME}_production up -d --build --force-recreate --remove-orphans
  environment:
    name: Production
    url: https://${URL_NAME}.${BASE_URL}
    on_stop: stop
  only:
    - master
  tags:
    - env-production

stop:
  stage: deployment
  when: manual
  script:
    - echo 'Stopping Production'
    - docker-compose --project-name ${PROJECT_NAME}_production stop
  environment:
    name: Production
    action: stop
  only:
    - master
  tags:
    - env-production
