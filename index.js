var baseURL=location.hostname==="localhost"||location.hostname==="127.0.0.1"?"":"https://spotify.marroquin.dev";document.getElementById("login-button").addEventListener("click",function(){window.location.href=baseURL+"/login"},false);var pagination=1;var navigation=1;var userProfile1=Handlebars.compile(document.getElementById("perfil-template").innerHTML);var userProfile2=document.getElementById("perfil");var playedSongs1=Handlebars.compile(document.getElementById("played-template").innerHTML);var playedSongs2=document.getElementById("played");var getHashParams=function(){var hashParams={};var e;var r=/([^&;=]+)=?([^&;]*)/g;var q=window.location.hash.substring(1);while(e=r.exec(q)){hashParams[e[1]]=decodeURIComponent(e[2])}return hashParams};var logout=function(){window.location.hash="";$("#login").show();$("#loggedin").hide()};function getHistory(page){$.ajax({url:baseURL+"/my_history",data:{page:page,access_token:params.access_token}}).done(function(data){pagination=page;navigation=data.navigation;console.log(pagination,navigation,data);playedSongs2.innerHTML=playedSongs1(data);$(".pagination-number").removeClass("active");$("#pg-"+pagination).addClass("active");document.getElementById("pagination-previous").addEventListener("click",function(){pagination-=1;if(pagination<1)pagination=1;else getHistory(pagination)},false);document.getElementById("pagination-next").addEventListener("click",function(){pagination+=1;if(pagination>navigation)pagination=navigation;else getHistory(pagination)},false);data.nav.forEach(function(navNumber){var classNumber="pg-"+navNumber;document.getElementById(classNumber).addEventListener("click",function(){var pageNumber=Number($("#"+classNumber).children().text());getHistory(pageNumber)})})}).fail(function(error){if(error.status===418)logout();console.log({error:error})})}var params=getHashParams();if(params.error)alert("There was an error during the authentication");else{if(params.access_token){$.ajax({url:"https://api.spotify.com/v1/me",headers:{Authorization:"Bearer "+params.access_token}}).done(function(res){userProfile2.innerHTML=userProfile1(res);$("#login").hide();$("#loggedin").show()}).fail(function(){logout()})}else logout();document.getElementById("obtain-last-played").addEventListener("click",function(){$.ajax({url:baseURL+"/last_played",data:{access_token:params.access_token}}).done(function(data){console.log(data)}).fail(function(error){if(error.status===418)logout()})},false);document.getElementById("perfil-obtain").addEventListener("click",function(){$("#perfil").show();$("#played").hide()},false);document.getElementById("played-obtain").addEventListener("click",function(){$("#perfil").hide();$("#played").show();getHistory(pagination)},false);document.getElementById("logout-obtain").addEventListener("click",function(){logout()},false);$(".nav-item").on("click",function(){$(".navbar-collapse").collapse("hide");$(".nav-link").removeClass("active");$(this).children().addClass("active")})}